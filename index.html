<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braza Brava - Gesti칩n Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .ticket-font { font-family: 'Courier New', Courier, monospace; }
        .animate-pop { animation: pop 0.3s ease-out; }
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @media print {
            .no-print { display: none; }
            .print-only { display: block; color: black !important; }
            body { background: white; color: black; }
        }
    </style>
</head>
<body class="pb-24">

    <!-- Navegaci칩n Superior -->
    <nav class="fixed top-0 left-0 w-full bg-zinc-950/90 backdrop-blur-xl border-b border-zinc-900 z-50 px-6 py-4 no-print">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i data-lucide="flame" class="text-orange-600 fill-orange-600"></i>
                <h1 class="text-xl font-black italic tracking-tighter uppercase">Braza Brava</h1>
            </div>
            <div class="flex gap-4 md:gap-8">
                <button onclick="switchView('pedidos')" class="nav-btn text-orange-500 flex flex-col items-center gap-1" id="btn-pedidos">
                    <i data-lucide="plus-circle" size="20"></i>
                    <span class="text-[9px] font-black uppercase">Ventas</span>
                </button>
                <button onclick="switchView('cocina')" class="nav-btn text-zinc-500 flex flex-col items-center gap-1 relative" id="btn-cocina">
                    <i data-lucide="chef-hat" size="20"></i>
                    <span id="badge-cocina" class="hidden absolute -top-1 -right-1 bg-red-600 w-2.5 h-2.5 rounded-full border-2 border-black"></span>
                    <span class="text-[9px] font-black uppercase">Cocina</span>
                </button>
                <button onclick="switchView('caja')" class="nav-btn text-zinc-500 flex flex-col items-center gap-1" id="btn-caja">
                    <i data-lucide="receipt" size="20"></i>
                    <span class="text-[9px] font-black uppercase">Caja</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="mt-24 px-4 max-w-6xl mx-auto">
        <!-- Notificaci칩n de Error -->
        <div id="error-banner" class="hidden bg-red-600 text-white p-4 rounded-2xl mb-6 text-xs font-bold text-center"></div>
        
        <!-- VISTA VENTAS -->
        <section id="view-pedidos" class="view-section grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
                <!-- Selectores de Servicio -->
                <div class="bg-zinc-900 p-4 rounded-3xl mb-6 border border-zinc-800">
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button onclick="setService('local')" id="svc-local" class="svc-btn py-3 rounded-2xl font-black text-[10px] bg-orange-600">LOCAL</button>
                        <button onclick="setService('llevar')" id="svc-llevar" class="svc-btn py-3 rounded-2xl font-black text-[10px] bg-zinc-800">LLEVAR</button>
                        <button onclick="setService('domicilio')" id="svc-domicilio" class="svc-btn py-3 rounded-2xl font-black text-[10px] bg-zinc-800">DOMICILIO</button>
                    </div>
                    
                    <div id="mesa-selector" class="flex gap-2 overflow-x-auto py-2 scrollbar-hide">
                        <!-- Mesas JS -->
                    </div>

                    <div id="domicilio-inputs" class="hidden flex flex-col gap-3 mt-2">
                        <input type="text" id="dom-dir" placeholder="Direcci칩n / Cliente" class="bg-zinc-800 p-4 rounded-2xl text-sm outline-none border border-zinc-700">
                        <input type="number" id="dom-cost" placeholder="Costo Env칤o ($)" class="bg-zinc-800 p-4 rounded-2xl text-sm outline-none border border-zinc-700">
                    </div>
                </div>

                <!-- Men칰 -->
                <div id="menu-container" class="space-y-8">
                    <!-- Categor칤as JS -->
                </div>
            </div>

            <!-- Carrito / Orden -->
            <div class="lg:sticky lg:top-28 h-fit">
                <div class="bg-zinc-900 border border-zinc-800 rounded-[40px] p-6 shadow-2xl">
                    <h4 class="font-black italic text-xl uppercase mb-6">Tu Pedido</h4>
                    <div id="cart-items" class="space-y-4 max-h-[40vh] overflow-y-auto pr-2 scrollbar-hide mb-6">
                        <p class="text-zinc-600 text-xs italic text-center py-4">Carrito vac칤o</p>
                    </div>
                    <div class="border-t border-zinc-800 pt-6">
                        <div class="flex justify-between items-end mb-6">
                            <span class="text-[10px] font-black text-zinc-500 uppercase">Total Orden</span>
                            <span id="cart-total" class="text-3xl font-black italic">$0</span>
                        </div>
                        <button onclick="sendToKitchen()" class="w-full py-5 rounded-3xl font-black text-xs uppercase bg-green-600 hover:bg-green-500 transition-all">ENVIAR A COCINA 游댠</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- VISTA COCINA -->
        <section id="view-cocina" class="view-section hidden">
            <h2 class="text-2xl font-black italic mb-8 border-l-4 border-orange-600 pl-4 uppercase">Cocina</h2>
            <div id="cocina-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Pedidos Cocina JS -->
            </div>
        </section>

        <!-- VISTA CAJA -->
        <section id="view-caja" class="view-section hidden">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-2xl font-black italic border-l-4 border-green-600 pl-4 uppercase">Caja</h2>
                <button onclick="openZReport()" class="bg-white text-black px-6 py-3 rounded-2xl text-[10px] font-black uppercase flex items-center gap-2">
                    <i data-lucide="bar-chart-3" size="16"></i> CIERRE DETALLADO
                </button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div id="caja-pendientes" class="lg:col-span-2 space-y-4">
                    <!-- Cuentas pendientes JS -->
                </div>
                <div id="caja-resumen" class="bg-zinc-900 p-6 rounded-[40px] border border-zinc-800 h-fit">
                    <!-- Resumen parcial JS -->
                </div>
            </div>
        </section>
    </main>

    <!-- MODALES Y SCRIPTS -->
    <div id="modal-pago" class="fixed inset-0 z-[100] bg-black/95 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-zinc-900 border border-zinc-800 w-full max-w-lg rounded-[48px] p-8 shadow-2xl relative">
            <button onclick="closeModal('modal-pago')" class="absolute top-6 right-6 text-zinc-500"><i data-lucide="x"></i></button>
            <div id="pago-content"></div>
        </div>
    </div>

    <div id="modal-cierre" class="fixed inset-0 z-[100] bg-black/95 hidden flex items-center justify-center p-4 backdrop-blur-md overflow-y-auto">
        <div class="bg-zinc-50 text-black w-full max-w-lg rounded-[48px] p-8 ticket-font shadow-2xl relative my-8 overflow-hidden">
            <button onclick="closeModal('modal-cierre')" class="absolute top-6 right-6 text-zinc-400 no-print"><i data-lucide="x"></i></button>
            <div id="cierre-content"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, updateDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // CONFIGURACI칍N DE AMBIENTE
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id || 'braza-brava-v1';

        // ESTADO GLOBAL
        let currentUser = null;
        let state = {
            view: 'pedidos',
            serviceType: 'local',
            selectedMesa: '1',
            cart: [],
            pedidos: [],
            payingOrder: null,
            baseCaja: 100000
        };

        const MENU = [
            { cat: 'Hamburguesas', items: [{n:'Sencilla Brava', p:15000}, {n:'Doble Braza', p:22000}] },
            { cat: 'Perros Vapor', items: [{n:'Sencillo Vapor', p:10000}, {n:'Especial Vapor', p:14000}] },
            { cat: 'Salchipapas', items: [{n:'Salchi Sencilla', p:12000}, {n:'Brava Mix', p:28000}] },
            { cat: 'Bebidas', items: [{n:'Gaseosa', p:4500}, {n:'Jugo Natural', p:6000}] }
        ];

        // INICIALIZACI칍N SEGURA
        async function init() {
            lucide.createIcons();
            renderMenu();
            renderMesas();

            // Regla 3: Autenticar PRIMERO
            try {
                if (typeof window.__initial_auth_token !== 'undefined' && window.__initial_auth_token) {
                    await signInWithCustomToken(auth, window.__initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) {
                showError("Error de autenticaci칩n: " + err.message);
            }

            // Escuchar cambios de auth antes de cualquier operaci칩n Firestore
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    currentUser = user;
                    startDataListener();
                } else {
                    currentUser = null;
                    showError("No se ha podido validar la identidad del usuario.");
                }
            });
        }

        function startDataListener() {
            // Regla 1: Usar path estricto /artifacts/{appId}/public/data/{collection}
            const pedidosRef = collection(db, 'artifacts', appId, 'public', 'data', 'pedidos');
            
            onSnapshot(pedidosRef, 
                (snap) => {
                    state.pedidos = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    updateUI();
                },
                (err) => {
                    console.error("Firestore Error:", err);
                    showError("Error de permisos en tiempo real. Verifique la conexi칩n.");
                }
            );
        }

        function showError(msg) {
            const banner = document.getElementById('error-banner');
            banner.innerText = msg;
            banner.classList.remove('hidden');
            setTimeout(() => banner.classList.add('hidden'), 5000);
        }

        // FUNCIONES DE NAVEGACI칍N
        window.switchView = (v) => {
            state.view = v;
            document.querySelectorAll('.view-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`view-${v}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-orange-500', 'text-zinc-500'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('text-green-500', 'text-zinc-500'));
            const color = v === 'caja' ? 'text-green-500' : 'text-orange-500';
            document.getElementById(`btn-${v}`).classList.replace('text-zinc-500', color);
            updateUI();
        };

        window.setService = (s) => {
            state.serviceType = s;
            document.querySelectorAll('.svc-btn').forEach(b => b.classList.replace('bg-orange-600', 'bg-zinc-800'));
            document.getElementById(`svc-${s}`).classList.replace('bg-zinc-800', 'bg-orange-600');
            document.getElementById('mesa-selector').classList.toggle('hidden', s !== 'local');
            document.getElementById('domicilio-inputs').classList.toggle('hidden', s !== 'domicilio');
        };

        // GESTI칍N DE CARRITO
        window.addToCart = (name, price) => {
            state.cart.push({ name, price, qty: 1, id: Date.now() });
            updateUI();
        };

        window.updateQty = (id, delta) => {
            const item = state.cart.find(i => i.id === id);
            if (item) {
                item.qty = Math.max(1, item.qty + delta);
                if (item.qty === 0) state.cart = state.cart.filter(i => i.id !== id);
            }
            updateUI();
        };

        // ACCIONES FIREBASE (Guardia de usuario presente)
        window.sendToKitchen = async () => {
            if (!currentUser || state.cart.length === 0) return;
            const dir = document.getElementById('dom-dir').value;
            const cost = Number(document.getElementById('dom-cost').value) || 0;

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'pedidos'), {
                    items: state.cart,
                    tipo: state.serviceType,
                    mesa: state.serviceType === 'local' ? state.selectedMesa : null,
                    destino: dir || null,
                    costoEnvio: cost,
                    total: state.cart.reduce((a, b) => a + (b.price * b.qty), 0),
                    estado: 'Pendiente',
                    pagoEstado: 'Pendiente',
                    timestamp: serverTimestamp(),
                    createdBy: currentUser.uid
                });
                state.cart = [];
                document.getElementById('dom-dir').value = '';
                document.getElementById('dom-cost').value = '';
                updateUI();
            } catch (e) {
                showError("Error al enviar: Permisos denegados.");
            }
        };

        window.updateEstado = async (id, nuevo) => {
            if (!currentUser) return;
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pedidos', id), { estado: nuevo });
        };

        window.procesarPago = async (metodo, propina = 0) => {
            if (!currentUser || !state.payingOrder) return;
            const final = state.payingOrder.total + state.payingOrder.costoEnvio + propina;
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'pedidos', state.payingOrder.id), {
                pagoEstado: 'Pagado',
                metodoPago: metodo,
                propina: propina,
                totalFinal: final,
                fechaPago: serverTimestamp()
            });
            closeModal('modal-pago');
        };

        // RENDERERS (UI)
        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = MENU.map(c => `
                <div>
                    <h3 class="text-[10px] font-black uppercase text-orange-500 mb-3 flex items-center gap-2">
                        <i data-lucide="utensils-crossed" size="14"></i> ${c.cat}
                    </h3>
                    <div class="grid grid-cols-2 gap-3">
                        ${c.items.map(i => `
                            <button onclick="addToCart('${i.n}', ${i.p})" class="bg-zinc-900 border border-zinc-800 p-4 rounded-2xl text-left active:scale-95 transition-all">
                                <p class="font-bold text-xs">${i.n}</p>
                                <p class="font-black text-orange-500 text-xs mt-1">$${i.p.toLocaleString()}</p>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderMesas() {
            const container = document.getElementById('mesa-selector');
            container.innerHTML = Array.from({length:15}, (_,i) => i+1).map(m => `
                <button onclick="state.selectedMesa='${m}'; updateUI();" class="min-w-[44px] h-[44px] rounded-xl font-black text-xs ${state.selectedMesa == m ? 'bg-white text-black' : 'bg-zinc-800 text-zinc-500'}">
                    ${m}
                </button>
            `).join('');
        }

        function updateUI() {
            // Actualizar Carrito
            const cartList = document.getElementById('cart-items');
            if (state.cart.length === 0) {
                cartList.innerHTML = `<p class="text-zinc-600 text-xs italic text-center py-4">Carrito vac칤o</p>`;
            } else {
                cartList.innerHTML = state.cart.map(i => `
                    <div class="bg-zinc-800/50 p-4 rounded-2xl border border-zinc-800 flex justify-between items-center">
                        <div>
                            <p class="font-bold text-xs">${i.name}</p>
                            <p class="text-[10px] text-zinc-500">$${(i.price * i.qty).toLocaleString()}</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="updateQty(${i.id}, -1)" class="text-orange-500 font-black">-</button>
                            <span class="text-xs font-black">${i.qty}</span>
                            <button onclick="updateQty(${i.id}, 1)" class="text-orange-500 font-black">+</button>
                        </div>
                    </div>
                `).join('');
            }
            const total = state.cart.reduce((a, b) => a + (b.price * b.qty), 0);
            document.getElementById('cart-total').innerText = `$${total.toLocaleString()}`;

            // Cocina
            const cocinaGrid = document.getElementById('cocina-grid');
            const pendientes = state.pedidos.filter(p => p.estado !== 'Listo');
            document.getElementById('badge-cocina').classList.toggle('hidden', pendientes.length === 0);
            cocinaGrid.innerHTML = pendientes.map(p => `
                <div class="bg-zinc-900 rounded-3xl p-6 border-t-4 border-orange-600 animate-pop">
                    <div class="flex justify-between items-start mb-4">
                        <span class="bg-white text-black px-2 py-1 rounded text-[10px] font-black uppercase">
                            ${p.tipo === 'local' ? 'Mesa '+p.mesa : p.tipo}
                        </span>
                        <span class="text-[9px] text-zinc-500">
                            ${p.timestamp ? new Date(p.timestamp.seconds*1000).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : '--:--'}
                        </span>
                    </div>
                    <div class="space-y-2 mb-6">
                        ${p.items.map(it => `<p class="text-xs font-bold text-zinc-300">${it.qty}x ${it.name}</p>`).join('')}
                    </div>
                    <button onclick="updateEstado('${p.id}', '${p.estado === 'Pendiente' ? 'Cocinando' : 'Listo'}')" class="w-full py-3 rounded-xl text-[10px] font-black uppercase ${p.estado === 'Pendiente' ? 'bg-blue-600' : 'bg-green-600'}">
                        ${p.estado === 'Pendiente' ? 'COMENZAR' : 'TERMINAR'}
                    </button>
                </div>
            `).join('');

            // Caja
            if (state.view === 'caja') {
                const pend = state.pedidos.filter(p => p.pagoEstado === 'Pendiente');
                document.getElementById('caja-pendientes').innerHTML = pend.map(p => `
                    <div class="bg-zinc-900 p-6 rounded-3xl flex justify-between items-center border border-zinc-800">
                        <div>
                            <p class="font-black italic uppercase">${p.tipo === 'local' ? 'Mesa '+p.mesa : p.tipo}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">${p.items.length} productos</p>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-black italic">$${(p.total + p.costoEnvio).toLocaleString()}</p>
                            <button onclick="openPago('${p.id}')" class="bg-green-600 px-4 py-2 rounded-xl text-[9px] font-black uppercase mt-2">COBRAR</button>
                        </div>
                    </div>
                `).join('');

                const stats = getStats();
                document.getElementById('caja-resumen').innerHTML = `
                    <p class="text-[10px] font-black text-zinc-500 uppercase mb-4">Resumen Turno</p>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-xs font-bold">Venta Bruta:</span>
                            <span class="font-black">$${stats.bruta.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between text-green-500">
                            <span class="text-xs font-bold">Propinas:</span>
                            <span class="font-black">$${stats.propinas.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between text-blue-500 border-b border-zinc-800 pb-4">
                            <span class="text-xs font-bold">Env칤os:</span>
                            <span class="font-black">$${stats.envios.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between pt-2">
                            <span class="text-sm font-black italic">VENTA TOTAL:</span>
                            <span class="text-xl font-black italic text-orange-500">$${stats.neta.toLocaleString()}</span>
                        </div>
                    </div>
                `;
            }
            lucide.createIcons();
        }

        function getStats() {
            const pagados = state.pedidos.filter(p => p.pagoEstado === 'Pagado');
            const bruta = pagados.reduce((a, b) => a + b.total, 0);
            const propinas = pagados.reduce((a, b) => a + (b.propina || 0), 0);
            const envios = pagados.reduce((a, b) => a + (b.costoEnvio || 0), 0);
            
            const porMetodo = { efectivo: 0, tarjeta: 0, transferencia: 0 };
            pagados.forEach(p => {
                const monto = p.totalFinal || (p.total + p.costoEnvio + (p.propina || 0));
                if (p.metodoPago === 'Efectivo') porMetodo.efectivo += monto;
                if (p.metodoPago === 'Tarjeta') porMetodo.tarjeta += monto;
                if (p.metodoPago === 'QR') porMetodo.transferencia += monto;
            });

            const porCat = {};
            pagados.forEach(p => p.items.forEach(i => porCat[i.name] = (porCat[i.name] || 0) + i.qty));

            return { bruta, propinas, envios, neta: bruta + propinas + envios, porMetodo, porCat };
        }

        window.openPago = (id) => {
            state.payingOrder = state.pedidos.find(p => p.id === id);
            document.getElementById('modal-pago').classList.remove('hidden');
            renderPago();
        };

        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');

        function renderPago() {
            const p = state.payingOrder;
            const content = document.getElementById('pago-content');
            content.innerHTML = `
                <h3 class="text-2xl font-black italic uppercase mb-6 text-center">Cobrar Cuenta</h3>
                <div class="bg-zinc-100 text-black p-6 rounded-3xl mb-6 ticket-font text-[11px] shadow-inner">
                    <p class="text-center font-black mb-4">BRAZA BRAVA - TICKET</p>
                    ${p.items.map(it => `<div class="flex justify-between"><span>${it.qty}x ${it.name}</span><span>$${(it.price*it.qty).toLocaleString()}</span></div>`).join('')}
                    <div class="border-t border-dashed border-zinc-400 mt-4 pt-4 space-y-1">
                        <div class="flex justify-between font-bold"><span>Total Base:</span><span>$${p.total.toLocaleString()}</span></div>
                        ${p.costoEnvio ? `<div class="flex justify-between"><span>Env칤o:</span><span>$${p.costoEnvio.toLocaleString()}</span></div>` : ''}
                        <div class="flex justify-between text-lg font-black pt-2"><span>A PAGAR:</span><span>$${(p.total + p.costoEnvio).toLocaleString()}</span></div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2 mb-6">
                    <button onclick="handlePagoAction('Efectivo')" class="bg-zinc-800 py-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-green-600 transition-all">
                        <i data-lucide="banknote"></i><span class="text-[9px] font-black">EFECTIVO</span>
                    </button>
                    <button onclick="handlePagoAction('Tarjeta')" class="bg-zinc-800 py-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-blue-600 transition-all">
                        <i data-lucide="credit-card"></i><span class="text-[9px] font-black">TARJETA</span>
                    </button>
                    <button onclick="handlePagoAction('QR')" class="bg-zinc-800 py-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-purple-600 transition-all">
                        <i data-lucide="smartphone"></i><span class="text-[9px] font-black">QR / TRANSF</span>
                    </button>
                </div>
                <div class="text-center">
                    <p class="text-[10px] font-bold text-zinc-500 uppercase mb-2">쮻esea agregar propina?</p>
                    <input type="number" id="propina-input" placeholder="$ Valor Propina" class="bg-zinc-800 w-full p-4 rounded-2xl text-center font-black outline-none border border-zinc-700">
                </div>
            `;
            lucide.createIcons();
        }

        window.handlePagoAction = (metodo) => {
            const propina = Number(document.getElementById('propina-input').value) || 0;
            window.procesarPago(metodo, propina);
        };

        window.openZReport = () => {
            const stats = getStats();
            document.getElementById('modal-cierre').classList.remove('hidden');
            document.getElementById('cierre-content').innerHTML = `
                <div class="text-center mb-8 border-b border-zinc-300 pb-6">
                    <h3 class="text-xl font-black italic uppercase">REPORTE DE CIERRE</h3>
                    <p class="text-[10px] text-zinc-500 font-bold uppercase mt-1">Braza Brava - ${new Date().toLocaleDateString()}</p>
                </div>
                <div class="space-y-6 mb-8">
                    <div>
                        <p class="text-[10px] font-black text-zinc-400 border-b border-zinc-100 pb-1 mb-3 uppercase">Efectivo en Caja</p>
                        <div class="flex justify-between text-xs mb-1"><span>Base Inicial:</span><span>$${state.baseCaja.toLocaleString()}</span></div>
                        <div class="flex justify-between text-xs mb-2"><span>Ventas Efectivo:</span><span>$${stats.porMetodo.efectivo.toLocaleString()}</span></div>
                        <div class="bg-zinc-100 p-3 rounded-xl flex justify-between font-black"><span>EFECTIVO FINAL:</span><span>$${(state.baseCaja + stats.porMetodo.efectivo).toLocaleString()}</span></div>
                    </div>
                    <div>
                        <p class="text-[10px] font-black text-zinc-400 border-b border-zinc-100 pb-1 mb-3 uppercase">Desglose de Turno</p>
                        <div class="flex justify-between text-xs mb-1"><span>Ventas Brutas:</span><span>$${stats.bruta.toLocaleString()}</span></div>
                        <div class="flex justify-between text-xs mb-1"><span>Total Propinas:</span><span class="text-green-600">$${stats.propinas.toLocaleString()}</span></div>
                        <div class="flex justify-between text-xs"><span>Total Domicilios:</span><span class="text-blue-600">$${stats.envios.toLocaleString()}</span></div>
                        <div class="text-right pt-4"><p class="text-lg font-black italic">TOTAL: $${stats.neta.toLocaleString()}</p></div>
                    </div>
                </div>
                <div class="no-print space-y-3">
                    <button onclick="window.print()" class="w-full bg-zinc-900 text-white py-4 rounded-2xl font-black text-[10px] uppercase flex items-center justify-center gap-2">
                        <i data-lucide="printer" size="16"></i> Imprimir Ticket
                    </button>
                    <button onclick="shareWhatsApp()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase flex items-center justify-center gap-2">
                        <i data-lucide="message-circle" size="16"></i> Enviar al Due침o
                    </button>
                </div>
            `;
            lucide.createIcons();
        };

        window.shareWhatsApp = () => {
            const stats = getStats();
            const text = `游댠 CIERRE BRAZA BRAVA - ${new Date().toLocaleDateString()}\n---\n游눯 Efectivo: $${(state.baseCaja + stats.porMetodo.efectivo).toLocaleString()}\n游눱 Tarjetas: $${stats.porMetodo.tarjeta.toLocaleString()}\n游님 Transf: $${stats.porMetodo.transferencia.toLocaleString()}\n---\n游늳 TOTAL TURNO: $${stats.neta.toLocaleString()}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        };

        init();
    </script>
</body>
</html>